---
title: "Speed Limits and How They Affect the Severity of Injuries in Car Crashes"
author: "Yu-Hsiang Huang, Edward Lawrence, Rishi Nair"
date: "4/17/2024"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
---

# Introduction

# Data Exploration & Visualizations

## Extracting the Data

First, to explore the necessary data, we need to extract the features 'Injury Severity' and 'Speed Limit'.

```{r extract-columns, echo=TRUE, message=FALSE, warning=FALSE}
library(readr)  # for read_csv
library(dplyr)  # for data manipulation
library(ggplot2)
# Reading the data from the CSV file
file_path <- "C:/Users/lawre/Documents/GitHub/FP_Edward-Lawrence_Rishi-Nair_Yu-Hsiang-Huang/Maryland_Crash_Reporting_-_Drivers_Data.csv"
crash_data <- read_csv(file_path)

#Extracting 'Injury Severity' and 'Speed Limit' columns
selected_data <- crash_data %>%
  select(`Speed Limit`, `Injury Severity`)  
```
## Histogram
 Next we will use the function ggplot2 to make a histogram showing injuries over different speed limits.
 
```{r limit-injury-histogram, echo=TRUE, message=FALSE, warning=FALSE}
# Creating a histogram of crashes by speed limit
ggplot(selected_data, aes(x = `Speed Limit`)) +  
  geom_histogram(bins = 20, fill = "blue", color = "black") +
  labs(title = "Histogram of Crashes by Speed Limit",
       x = "Speed Limit (mph)",
       y = "Number of Crashes") +
  theme_minimal()
```
## Bar Chart
```{r limit-injury-bar-chart, echo=TRUE, message=FALSE, warning=FALSE}
# First, we count the number of occurrences of each injury severity for each speed limit
selected_data_summary <- crash_data %>%
  count(`Speed Limit`, `Injury Severity`) %>%
  mutate(`Injury Severity` = factor(`Injury Severity`, levels = c("NO APPARENT INJURY", "POSSIBLE INJURY", "SUSPECTED MINOR INJURY", "SUSPECTED SERIOUS INJURY", "FATAL INJURY")))

# Now we can create a stacked bar chart
ggplot(selected_data_summary, aes(x = factor(`Speed Limit`), y = n, fill = `Injury Severity`)) +
  geom_bar(stat = "identity") +
  labs(title = "Stacked Bar Chart of Crashes by Speed Limit and Injury Severity",
       x = "Speed Limit (mph)",
       y = "Crash Frequency") +
  theme_minimal() +
  scale_fill_brewer(palette = "Spectral") +  # Using a color palette that is distinct
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # To prevent overlapping of x labels


crash_frequency_by_speed_severity <- crash_data %>%
  group_by(`Speed Limit`, `Injury Severity`) %>%
  summarise(CrashFrequency = n(), .groups = 'drop')
```
## Scatter Plot
```{r limit-injury-scatter-plot, echo=TRUE, message=FALSE, warning=FALSE}
# Scatter plot with different colors for different severity levels
ggplot(crash_frequency_by_speed_severity, aes(x = `Speed Limit`, y = CrashFrequency)) +
  geom_point(aes(color = `Injury Severity`)) +  # Color points by severity
  geom_smooth(method = "lm", se = FALSE, aes(color = `Injury Severity`, group = `Injury Severity`)) +  # Add colored regression lines
  labs(title = "Scatter Plot of Crash Frequency by Speed Limit and Injury Severity",
       x = "Speed Limit (mph)",
       y = "Crash Frequency") +
  theme_minimal() +
  scale_color_brewer(palette = "Set1")  # Use a color brewer palette for distinct colors
```
